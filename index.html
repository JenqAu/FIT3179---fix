<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NBA Universe: The Court of Legends</title>

  <!-- Vega, Vega-Lite & Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <!-- NBA Header -->
  <header class="nba-topbar">
    <div class="nba-logo-text">
      <img src="logo-nba.svg" alt="NBA Logo" class="nba-logo">
    </div>
    <div class="project-title">
      <h1>The NBA Universe: Movement, Mastery & Myth</h1>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Scene 1: Origins -->
    <section class="scene origins">
      <div class="scene-header">
        <h1>Origins of Greatness</h1>
        <p>From the streets of Chicago to the beaches of LA — discover how birthplace shaped the map of basketball’s beginnings.</p>
      </div>
      <div class="map-container">
        <div id="choropleth_map"></div>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Scene 2: Legends Skill Radar -->
    <section class="radar-section">
      <div class="section-header">
        <h2>The Skill Constellation of Legends</h2>
        <p>
          Every legend leaves a unique imprint on the game — some ruled the paint, others redefined the perimeter.  
          Explore how twenty of basketball's immortals balanced <strong>power, precision, and playmaking</strong> to build their legacy.
          Leaders in each stat category are highlighted in <strong style="color: #2563eb;">blue</strong>.
        </p>
      </div>

      <div class="player-section-grid">
        <!-- Player Card -->
        <div class="player-card">
          <img id="photo" alt="Selected player portrait" hidden>
          <h3 id="player-name">Select a Legend</h3>
        </div>

        <!-- Player Stats -->
        <div class="player-stats">
          <h2>Signature Stats</h2>
          <ul id="stats-list">
            <li>2P: —</li>
            <li>3P: —</li>
            <li>AST: —</li>
            <li>TRB: —</li>
            <li>BLK: —</li>
            <li>STL: —</li>
          </ul>
          <p class="stat-caption">
            Each value represents <em>normalized career averages</em>, leveling the field across eras of play.
          </p>
        </div>

        <!-- Radar Chart -->
        <div class="radar-panel">
          <div id="radar_chart"></div>
        </div>

        <!-- Player Selector -->
        <div class="selector-panel">
          <label for="player-select"><strong>Compare Legends</strong></label>
          <select id="player-select" multiple size="10"></select>
          <p class="selector-hint">
            Tip: Hold <kbd>Ctrl</kbd> (Windows) or <kbd>Cmd</kbd> (Mac) to view overlapping skill signatures.
          </p>
        </div>
      </div>

      <div class="section-footer">
        <p>
          <div class="section-footer">
        <p>
          <div class="section-footer">
        <p>
          The radar reveals the <strong>geometry of greatness</strong>, but some patterns stand alone. 
          <strong style="color: #2563eb;">John Stockton</strong> is the only legend to dominate <strong>two</strong> categories: 
          assists and steals. His court vision didn't just create scoring opportunities; 
          it disrupted opponents with relentless defensive anticipation. Meanwhile, <strong style="color: #2563eb;">Wilt Chamberlain</strong> 
          anchored the paint with an unmatched total career rebounds of 25597, dominating the boards throughout his legendary career. 
          <strong style="color: #2563eb;">Kareem Abdul-Jabbar</strong> perfected efficiency with his unstoppable skyhook, 
          leading in 2-point scoring. Each legend carved a distinct path. Stockton's dual mastery proves that greatness 
          isn't just about one skill, but the rare synergy of multiple dimensions working in perfect harmony.
        </p>
      </div>
        </p>
      </div>
        </p>
      </div>
    </section>

    <hr class="section-divider">

    <!-- Scene 3: Shot Chart -->
    <section>
      <h2>Shot Map of a Champion</h2>
      <p>Every shot tells a story. Trace the rhythm and range of basketball’s most iconic scorers.</p>
      <div id="shot_chart"></div>
    </section>

    <hr class="section-divider">

    <!-- Scene 4: 3-Point Revolution -->
    <section>
      <h2>The 3-Point Revolution</h2>
      <p>From rare experiment to defining weapon — track how three-pointers reshaped the modern game.</p>
      <div id="threept_decades"></div>
    </section>

    <hr class="section-divider">

    <!-- Scene 5: Momentum Stream -->
    <section>
      <h2>Game Momentum Flow</h2>
      <p>Visualize the tides of competition — when control shifts, and legends rise in clutch moments.</p>
      <div id="momentum_graph"></div>
    </section>

    <hr class="section-divider">

    <!-- Scene 6: Dynasty Waffle -->
    <section>
      <h2>Dynasties of Dominance</h2>
      <p>Each ring represents a conquest — together, they chronicle decades of NBA supremacy.</p>
      <div id="dynasty_waffle"></div>
    </section>
  </main>

  <!-- JavaScript -->
  <script type="module">
    try {
      // Load visualizations
      await vegaEmbed('#choropleth_map', 'js/choropleth_map.vg.json', { actions: false });
      const radarResult = await vegaEmbed('#radar_chart', 'js/top_players_radar.vg.json', { actions: false });
      const radarView = radarResult.view;
      await vegaEmbed('#shot_chart', 'js/shot_scatter_joint.vg.json', { actions: false });
      await vegaEmbed('#threept_decades', 'js/threept_decades.vg.json', { actions: false });
      await vegaEmbed('#momentum_graph', 'js/nba_momentum_stream.vg.json', { actions: false });
      await vegaEmbed('#dynasty_waffle', 'js/nba_dynasty_waffle.vg.json', { actions: false });

      // Player Data & Dropdown Logic
      const playerSelect = document.getElementById('player-select');
      const playerNameEl = document.getElementById("player-name");
      const photoEl = document.getElementById("photo");
      const statsList = document.getElementById("stats-list");
      const defaultStatsHtml = ["2P","3P","AST","TRB","BLK","STL"].map(attr => `<li>${attr}: —</li>`).join("");

      const resetPlayerCard = () => {
        playerNameEl.textContent = "Select a Legend";
        photoEl.removeAttribute("src");
        photoEl.hidden = true;
        statsList.innerHTML = defaultStatsHtml;
      };

      const playerNames = [
        'Bill Russell','Charles Barkley','Eddie Johnson','Elvin Hayes','Hakeem Olajuwon',
        'Jason Kidd','John Stockton','Kareem Abdul-Jabbar','Karl Malone','Kevin Garnett',
        'Kobe Bryant','LeBron James','Michael Jordan','Moses Malone','Patrick Ewing',
        'Robert Parish','Shaquille O\'Neal','Tim Duncan','Walt Bellamy','Wilt Chamberlain'
      ];

      const playerIDs = {
        "LeBron James": 2544, "Michael Jordan": 893, "Kobe Bryant": 977, "Tim Duncan": 1495,
        "Wilt Chamberlain": 76375, "Shaquille O'Neal": 406, "Kareem Abdul-Jabbar": 76003,
        "Karl Malone": 252, "Kevin Garnett": 708, "Hakeem Olajuwon": 165, "Bill Russell": 78049,
        "Charles Barkley": 787, "Jason Kidd": 467, "John Stockton": 304, "Patrick Ewing": 121,
        "Moses Malone": 77449, "Robert Parish": 305, "Elvin Hayes": 76979, "Walt Bellamy": 76144,
        "Eddie Johnson": 698
      };

      const getPlayerImage = (name) => {
        const id = playerIDs[name];
        return id ? `https://cdn.nba.com/headshots/nba/latest/1040x760/${id}.png` : "images/default.jpg";
      };

      const statOrder = ["2P","3P","AST","TRB","BLK","STL"];
      const playerStats = new Map();

      const loadPlayerStats = async () => {
        const response = await fetch("data/top20_players_radar.csv");
        const csv = await response.text();
        const lines = csv.trim().split(/\r?\n/).slice(1);
        for (const line of lines) {
          const parts = line.split(",");
          if (parts.length < 3) continue;
          const player = parts[0].trim().replaceAll("*", "");
          const metric = parts[1].trim();
          const value = Number(parts[2].trim());
          if (!playerStats.has(player)) playerStats.set(player, {});
          playerStats.get(player)[metric] = Number.isFinite(value) ? value : parts[2].trim();
        }
      };

      await loadPlayerStats();

      // Calculate leaders for each stat
      const statLeaders = {};
      for (const attr of statOrder) {
        let maxValue = -Infinity;
        let leader = null;
        for (const [player, stats] of playerStats.entries()) {
          const value = stats[attr];
          if (typeof value === 'number' && value > maxValue) {
            maxValue = value;
            leader = player;
          }
        }
        statLeaders[attr] = leader;
      }

      // Determine which players are leaders in any category
      const leaderPlayers = new Set(Object.values(statLeaders));

      for (const name of playerNames) {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        if (leaderPlayers.has(name)) {
          option.style.color = "#2563eb";
          option.style.fontWeight = "600";
        }
        playerSelect.appendChild(option);
      }

      const applySelection = (player) => {
        if (!player) return resetPlayerCard();
        playerNameEl.textContent = player;
        photoEl.src = getPlayerImage(player);
        photoEl.hidden = false;
        const stats = playerStats.get(player) || {};
        statsList.innerHTML = statOrder.map(attr => {
          const value = stats[attr] ?? "—";
          const isLeader = statLeaders[attr] === player;
          const statName = isLeader ? `<strong style="color: #2563eb;">${attr}</strong>` : attr;
          const statValue = isLeader ? `<strong style="color: #2563eb;">${value}</strong>` : value;
          return `<li>${statName}: ${statValue}</li>`;
        }).join("");
      };

      const updateSelection = () => {
        const selected = Array.from(playerSelect.selectedOptions).map(opt => opt.value);
        const values = selected.length ? selected : [playerSelect.options[0].value];
        radarView.signal("selectedPlayers", values).runAsync();
        applySelection(values.at(-1));
      };

      playerSelect.addEventListener("change", updateSelection);
      const first = playerSelect.options[0].value;
      radarView.signal("selectedPlayers", [first]).runAsync();
      applySelection(first);

      radarView.addSignalListener("selectedPlayers", (_, value) => {
        const arr = Array.isArray(value) ? value : [value];
        if (!arr.length) return resetPlayerCard();
        applySelection(arr.at(-1));
      });

    } catch (err) {
      console.error(err);
    }
  </script>
</body>
</html>

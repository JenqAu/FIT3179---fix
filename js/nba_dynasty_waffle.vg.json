{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "NBA team dynasties shown as symbolic waffle charts — each 💍 = one championship ring.",
  "data": {"url": "data/nba_team_championships.csv"},

  "params": [
    {
      "name": "selectedEra",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "60s-80s", "80s-00s", "90s", "00s-10s", "10s"],
        "name": "Dynasty Era: "
      }
    }
  ],

  "transform": [
    {"calculate": "toNumber(datum.Championships)", "as": "rings"},
    {"filter": "datum.Championships > 1"},
    {"calculate": "sequence(0, 20)", "as": "ring_sequence"},
    {"flatten": ["ring_sequence"], "as": ["ring_index"]},
    {"calculate": "floor(datum.ring_index / 5)", "as": "row"},
    {"calculate": "datum.ring_index % 5", "as": "col"},
    {"filter": "selectedEra == 'All' || datum.PeakEra == selectedEra"}
  ],

  "facet": {
    "field": "FullName",
    "columns": 4,
    "header": {
      "labelFontSize": 12,
      "labelFontWeight": "bold",
      "labelColor": "#111827",
      "title": null,
      "labelPadding": 5
    }
  },

  "spec": {
    "width": 120,
    "height": 120,
    "mark": {
      "type": "image",
      "width": 24,
      "height": 24
    },
    "encoding": {
      "x": {"field": "col", "type": "ordinal", "axis": null},
      "y": {"field": "row", "type": "ordinal", "axis": null, "sort": "-y"},
      "url": {"value": "trophy.png"},
      "opacity": {"condition": {"test": "datum.ring_index < datum.rings", "value": 1}, "value": 0.3},
      "color": {
        "field": "PeakEra",
        "type": "nominal",
        "scale": {"scheme": "tableau10"},
        "legend": null
      },
      "tooltip": [
        {"field": "FullName", "title": "Team"},
        {"field": "rings", "title": "Total Championships"},
        {"field": "PeakEra", "title": "Dynasty Era"},
        {"field": "ring_index", "title": "Ring Slot", "format": "d"}
      ]
    }
  },

  "title": {
    "text": "🏆 Legacy & Dynasty: NBA Championships by Team",
    "subtitle": "Each = one championship ring. Colors show era of dominance.",
    "anchor": "start",
    "fontSize": 20,
    "subtitleFontSize": 13,
    "subtitleColor": "#4b5563",
    "color": "#111827"
  },

  "config": {
    "background": "#f9fafb",
    "view": {"stroke": "transparent"},
    "axis": {"labelFontSize": 10, "titleFontSize": 12}
  }
}

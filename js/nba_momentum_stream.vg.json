{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Streamgraph of NBA Finals momentum — 2016 Cavs vs Warriors",
  "background": "transparent",
  "data": {"url": "../data/nba_momentum_smoothed.csv"},

  "transform": [
    {
      "aggregate": [
        {"op": "mean", "field": "ScoreDiffSmooth", "as": "AverageDiff"}
      ],
      "groupby": ["Game", "TimeRounded", "LeadingTeam"]
    },
    {"filter": "datum.Game == '41500407'"}
  ],

  "width": 1000,
  "height": 250,

  "layer": [
    {
      "mark": {
        "type": "rule",
        "stroke": "#d1d5db",
        "strokeDash": [4, 4],
        "strokeWidth": 1
      },
      "transform": [{"calculate": "[12,24,36,48]", "as": "quarters"}, {"flatten": ["quarters"]} ],
      "encoding": {
        "x": {"field": "quarters", "type": "quantitative"},
        "y": {"value": 0},
        "y2": {"value": 250}
      }
    },
    {
      "mark": {
        "type": "text",
        "dy": -6,
        "fontSize": 11,
  "fontWeight": "normal",
        "fill": "#6b7280"
      },
      "transform": [
        {
          "calculate": "[{quarter:12,label:'1st Quarter'},{quarter:24,label:'2nd Quarter'},{quarter:36,label:'3rd Quarter'},{quarter:48,label:'4th Quarter'}]",
          "as": "quarterLabels"
        },
        {"flatten": ["quarterLabels"]}
      ],
      "encoding": {
        "x": {"field": "quarterLabels.quarter", "type": "quantitative"},
        "y": {"value": -10},
        "text": {"field": "quarterLabels.label"}
      }
    },
    {
      "mark": {"type": "area", "interpolate": "basis", "opacity": 0.85},
      "encoding": {
        "x": {
          "field": "TimeRounded",
          "type": "quantitative",
          "scale": {"domain": [0, 48], "nice": false},
          "axis": {
            "title": "Game Time (minutes)",
            "titleColor": "#ffffff",
            "tickCount": 8,
            "grid": false,
            "labelFontSize": 11,
            "labelColor": "#ffffff",
            "values": [0, 12, 24, 36, 48]
          }
        },
        "y": {
          "aggregate": "sum",
          "field": "AverageDiff",
          "type": "quantitative",
          "stack": "center",
          "axis": {"title": "Score Difference", "grid": false, "titleColor": "#ffffff" }
        },
        "color": {
          "field": "LeadingTeam",
          "type": "nominal",
          "scale": {
            "domain": ["Team A", "Team B", "Tied"],
            "range": ["#dc2626", "#1d4ed8", "#9ca3af"]
          },
          "legend": null
        },
        "tooltip": [
          {"field": "TimeRounded", "title": "Minute"},
          {"field": "LeadingTeam", "title": "Leader"},
          {"field": "AverageDiff", "title": "Avg Score Diff"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "right",
        "dx": -6,
        "dy": -6,
        "fontSize": 10,
        "fontStyle": "italic",
        "color": "#374151"
      },
      "transform": [
        {
          "aggregate": [
            {"op": "max", "field": "TimeRounded", "as": "xmax"}
          ],
          "groupby": ["Game"]
        }
      ],
      "encoding": {
        "x": {"field": "xmax", "type": "quantitative"},
        "y": {"value": 0},
        "text": {"value": "Final Buzzer →"}
      }
    }
  ],

  "config": {
    "background": "#f9fafb",
    "axis": {
      "labelFontSize": 10,
      "titleFontSize": 12,
      "labelColor": "#ffffff",
      "titleColor": "#111827"
    },
    "view": {"stroke": "transparent"}
  }
}
